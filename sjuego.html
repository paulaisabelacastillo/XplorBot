<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>XPL√òR - Hawker Hustle: Memory Food Rush</title>

  <!-- Fuentes -->
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#0da6f2",
            "background-light": "#f5f7f8",
            "background-dark": "#101c22",
          },
          fontFamily: {
            "display": ["Plus Jakarta Sans", "sans-serif"]
          },
          borderRadius: {
            "DEFAULT": "1rem",
            "lg": "2rem",
            "xl": "3rem",
            "full": "9999px"
          },
        },
      },
    }
  </script>

  <style>
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }
    .animate-float { animation: float 3s ease-in-out infinite; }

    /* Dropdown idiomas */
    #langMenu {
      position: absolute;
      right: 0;
      margin-top: 8px;
      width: 150px;
      background: white;
      border-radius: 0.5rem;
      overflow: hidden;
      border: 1px solid #ddd;
      display: none;
      z-index: 50;
    }
    #langMenu button {
      width: 100%;
      padding: 10px 12px;
      text-align: left;
      font-size: 14px;
    }
    #langMenu button:hover { background-color: #0da6f21a; }

    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }

    .dish-card.selected-correct {
      border-color: #16a34a !important;
      background-color: rgba(22,163,74,0.08) !important;
    }
    .dish-card.selected-wrong {
      border-color: #dc2626 !important;
      background-color: rgba(220,38,38,0.08) !important;
    }
  </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-200">
<div class="relative flex min-h-screen w-full flex-col overflow-x-hidden">
  <div class="flex h-full grow flex-col">

    <!-- HEADER -->
    <header class="sticky top-0 z-50 flex justify-center border-b border-gray-200/50 bg-background-light/80 px-4 py-3 backdrop-blur-sm dark:border-gray-800/50 dark:bg-background-dark/80 sm:px-8 md:px-10">
      <div class="flex w-full max-w-7xl items-center justify-between">
        <div class="flex items-center gap-8">
          <div class="flex items-center gap-2 text-slate-800 dark:text-white">
            <a href="index.html" class="flex items-center gap-2 text-slate-800 dark:text-white">
              <span class="material-symbols-outlined text-primary text-3xl">explore</span>
              <h2 class="text-xl font-bold tracking-tighter">XPL√òR</h2>
            </a>
          </div>
          <nav id="desktop-nav" class="hidden items-center gap-6 lg:flex">
            <a class="nav-link text-sm font-medium text-slate-700 hover:text-primary dark:text-slate-300 dark:hover:text-primary" href="index.html" data-en="HOME" data-es="INICIO">HOME</a>
            <a class="nav-link text-sm font-medium text-slate-700 hover:text-primary dark:text-slate-300 dark:hover:text-primary" href="explore.html" data-en="EXPLORE" data-es="EXPLORA">EXPLORE</a>
            <a class="nav-link text-sm font-medium text-slate-700 hover:text-primary dark:text-slate-300 dark:hover:text-primary" href="play.html" data-en="PLAY" data-es="JUEGA">PLAY</a>
            <a class="nav-link text-sm font-medium text-slate-700 hover:text-primary dark:text-slate-300 dark:hover:text-primary" href="learn.html" data-en="LEARN" data-es="APRENDE">LEARN</a>
            <a class="nav-link text-sm font-medium text-slate-700 hover:text-primary dark:text-slate-300 dark:hover:text-primary" href="earn.html" data-en="EARN" data-es="GANA">EARN</a>
            <a class="nav-link text-sm font-medium text-slate-700 hover:text-primary dark:text-slate-300 dark:hover:text-primary" href="about.html" data-en="ABOUT US" data-es="NOSOTROS">ABOUT US</a>
          </nav>
        </div>

        <div class="flex items-center gap-2">
          <a href="login.html" id="signupBtn" class="hidden min-w-[84px] md:flex cursor-pointer items-center justify-center overflow-hidden rounded-full bg-primary px-4 h-10 text-sm font-bold text-white transition-colors hover:bg-primary/90" data-en="LOG IN" data-es="INICIAR SESI√ìN">LOG IN</a>

          <div class="relative">
            <button id="langBtn" class="flex h-10 w-10 cursor-pointer items-center justify-center overflow-hidden rounded-full bg-slate-200/60 text-slate-700 transition-colors hover:bg-slate-200 dark:bg-slate-800/60 dark:text-slate-300 dark:hover:bg-slate-800">
              <span class="material-symbols-outlined text-xl">language</span>
            </button>
            <div id="langMenu">
              <button data-lang="en">English üá∫üá∏</button>
              <button data-lang="es">Espa√±ol üáµüá¶</button>
            </div>
          </div>

          <a href="user.html" id="profileBtn" class="flex h-10 w-10 cursor-pointer items-center justify-center overflow-hidden rounded-full bg-slate-200/60 text-slate-700 transition-colors hover:bg-slate-200 dark:bg-slate-800/60 dark:text-slate-300 dark:hover:bg-slate-800">
            <span class="material-symbols-outlined text-xl">person</span>
          </a>

          <button id="mobileMenuBtn" class="flex h-10 w-10 cursor-pointer items-center justify-center overflow-hidden rounded-full bg-slate-200/60 text-slate-700 transition-colors hover:bg-slate-200 dark:bg-slate-800/60 dark:text-slate-300 dark:hover:bg-slate-800 lg:hidden">
            <span id="menuIcon" class="material-symbols-outlined text-xl">menu</span>
          </button>
        </div>
      </div>
    </header>

    <!-- MOBILE MENU -->
    <div id="mobileMenu" class="fixed inset-0 z-40 hidden lg:hidden">
      <div id="menuOverlay" class="absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity duration-300 ease-in-out opacity-0"></div>

      <div id="menuContent" class="absolute right-0 top-0 h-full w-64 bg-background-light dark:bg-background-dark shadow-xl transform translate-x-full transition-transform duration-300 ease-in-out p-6">
        <div class="flex flex-col gap-4 pt-4">
          <a class="nav-link text-base font-medium text-slate-700 hover:text-primary dark:text-slate-300 dark:hover:text-primary" href="index.html" data-en="HOME" data-es="INICIO">HOME</a>
          <a class="nav-link text-base font-medium text-slate-700 hover:text-primary dark:text-slate-300 dark:hover:text-primary" href="explore.html" data-en="EXPLORE" data-es="EXPLORA">EXPLORE</a>
          <a class="nav-link text-base font-medium text-slate-700 hover:text-primary dark:text-slate-300 dark:hover:text-primary" href="play.html" data-en="PLAY" data-es="JUEGA">PLAY</a>
          <a class="nav-link text-base font-medium text-slate-700 hover:text-primary dark:text-slate-300 dark:hover:text-primary" href="learn.html" data-en="LEARN" data-es="APRENDE">LEARN</a>
          <a class="nav-link text-base font-medium text-slate-700 hover:text-primary dark:text-slate-300 dark:hover:text-primary" href="earn.html" data-en="EARN" data-es="GANA">EARN</a>
          <a class="nav-link text-base font-medium text-slate-700 hover:text-primary dark:text-slate-300 dark:hover:text-primary" href="about.html" data-en="ABOUT US" data-es="NOSOTROS">ABOUT US</a>

          <hr class="border-gray-200 dark:border-gray-700">

          <a href="login.html" class="flex cursor-pointer items-center justify-center overflow-hidden rounded-full bg-primary px-4 h-10 text-sm font-bold text-white transition-colors hover:bg-primary/90" data-en="LOG IN" data-es="INICIAR SESI√ìN">LOG IN</a>
        </div>
      </div>
    </div>

    <!-- MAIN -->
    <main class="px-4 sm:px-8 lg:px-16 xl:px-24 py-8 flex flex-1 justify-center">
      <div class="flex flex-col w-full max-w-5xl gap-8">

        <!-- HERO -->
        <section class="bg-cover bg-center bg-no-repeat rounded-2xl overflow-hidden shadow-md relative"
                 style='background-image: linear-gradient(135deg, rgba(0,0,0,0.7), rgba(0,0,0,0.2)), url("https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?auto=format&fit=crop&w=1600&q=80");'>
          <div class="p-8 md:p-10 lg:p-12 flex flex-col md:flex-row items-center gap-8">
            <div class="text-white max-w-xl">
              <p class="uppercase text-xs font-semibold tracking-[0.2em] mb-2"
                 data-en="SINGAPORE ‚Ä¢ ARCADE MEMORY GAME"
                 data-es="SINGAPUR ‚Ä¢ JUEGO ARCADE DE MEMORIA">
                SINGAPORE ‚Ä¢ ARCADE MEMORY GAME
              </p>
              <h1 class="text-3xl md:text-4xl font-extrabold mb-3"
                  data-en="Hawker Hustle: Memory Food Rush"
                  data-es="Hawker Hustle: Carrera de Memoria Gastron√≥mica">
                Hawker Hustle: Memory Food Rush
              </h1>
              <p class="text-sm md:text-base text-white/90 mb-4"
                 data-en="Memorize the orders, find the right dishes and serve them before time runs out in a fast-paced hawker centre!"
                 data-es="Memoriza los pedidos, encuentra los platos correctos y s√≠rvelos antes de que se acabe el tiempo en un hawker centre lleno de energ√≠a.">
                Memorize the orders, find the right dishes and serve them before time runs out in a fast-paced hawker centre!
              </p>
              <ul class="text-xs md:text-sm text-white/90 space-y-1">
                <li data-en="‚úî Fast rounds, no downloads, just play"
                    data-es="‚úî Rondas r√°pidas, sin descargas, solo jugar">
                  ‚úî Fast rounds, no downloads, just play
                </li>
                <li data-en="‚úî Learn iconic Singapore dishes while playing"
                    data-es="‚úî Aprende platos ic√≥nicos de Singapur mientras juegas">
                  ‚úî Learn iconic Singapore dishes while playing
                </li>
                <li data-en="‚úî Perfect mini-game for XPL√òR missions"
                    data-es="‚úî Mini-juego perfecto para misiones XPL√òR">
                  ‚úî Perfect mini-game for XPL√òR missions
                </li>
              </ul>
            </div>
            <div class="bg-white/10 border border-white/20 rounded-2xl p-4 md:p-6 text-center text-white animate-float">
              <span class="material-symbols-outlined text-6xl mb-3">restaurant_menu</span>
              <p class="font-semibold text-sm mb-1"
                 data-en="Ready to cook under pressure?"
                 data-es="¬øLista para cocinar bajo presi√≥n?">
                Ready to cook under pressure?
              </p>
              <p class="text-xs text-white/80"
                 data-en="Memorize orders, match dishes and earn XP."
                 data-es="Memoriza pedidos, combina platos y gana XP.">
                Memorize orders, match dishes and earn XP.
              </p>
            </div>
          </div>
        </section>

        <!-- GAME CARD -->
        <section class="bg-white dark:bg-gray-900 rounded-2xl shadow-md p-6 md:p-8">
          <!-- Top status bar -->
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
            <div>
              <p class="text-xs uppercase font-semibold text-slate-500 dark:text-slate-400 tracking-[0.2em]"
                 data-en="GAME STATUS"
                 data-es="ESTADO DEL JUEGO">
                GAME STATUS
              </p>
              <h2 class="text-xl font-bold"
                  data-en="Memorize. Match. Serve Fast."
                  data-es="Memoriza. Combina. Sirve R√°pido.">
                Memorize. Match. Serve Fast.
              </h2>
            </div>
            <div class="flex flex-wrap gap-4 text-xs md:text-sm">
              <div class="flex items-center gap-2 bg-slate-100 dark:bg-slate-800 px-3 py-2 rounded-full">
                <span class="material-symbols-outlined text-base text-primary">quiz</span>
                <span data-en="Round" data-es="Ronda">Round</span>:
                <span id="roundLabel" class="font-semibold">1</span>/5
              </div>
              <div class="flex items-center gap-2 bg-slate-100 dark:bg-slate-800 px-3 py-2 rounded-full">
                <span class="material-symbols-outlined text-base text-primary">schedule</span>
                <span data-en="Time" data-es="Tiempo">Time</span>:
                <span id="timeLabel" class="font-semibold">00</span>s
              </div>
              <div class="flex items-center gap-2 bg-slate-100 dark:bg-slate-800 px-3 py-2 rounded-full">
                <span class="material-symbols-outlined text-base text-primary">military_tech</span>
                <span data-en="Score" data-es="Puntuaci√≥n">Score</span>:
                <span id="scoreLabel" class="font-semibold">0</span> XP
              </div>
            </div>
          </div>

          <!-- Order + Controls -->
          <div class="grid md:grid-cols-2 gap-6 mb-6">
            <div class="bg-slate-50 dark:bg-slate-800/80 rounded-xl p-4 flex flex-col gap-3">
              <p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-[0.2em]"
                 data-en="ORDER TO MEMORIZE"
                 data-es="PEDIDO PARA MEMORIZAR">
                ORDER TO MEMORIZE
              </p>
              <div id="orderContainer" class="min-h-[96px] flex flex-wrap gap-2 items-center">
                <p id="orderMessage" class="text-sm text-slate-600 dark:text-slate-300"
                   data-en="Click on ‚ÄúStart Game‚Äù to receive your first order."
                   data-es="Haz clic en ‚ÄúIniciar Juego‚Äù para recibir tu primer pedido.">
                  Click on ‚ÄúStart Game‚Äù to receive your first order.
                </p>
              </div>
              <p id="phaseLabel" class="text-xs font-medium text-primary mt-1"></p>
            </div>

            <div class="flex flex-col gap-3 justify-center">
              <button id="startButton"
                      class="w-full bg-primary text-white font-bold py-3 rounded-full text-sm md:text-base hover:bg-primary/90 transition-colors">
                <span class="material-symbols-outlined align-middle mr-1">play_arrow</span>
                <span data-en="Start Game" data-es="Iniciar Juego">Start Game</span>
              </button>
              <button id="instructionsToggle"
                      class="w-full border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-200 font-medium py-2.5 rounded-full text-xs md:text-sm hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors flex items-center justify-center gap-1.5">
                <span class="material-symbols-outlined text-sm">info</span>
                <span data-en="Show / Hide Instructions" data-es="Mostrar / Ocultar Instrucciones">Show / Hide Instructions</span>
              </button>
            </div>
          </div>

          <!-- Instructions -->
          <div id="instructionsBox" class="hidden mb-6 bg-slate-50 dark:bg-slate-800/80 rounded-xl p-4 text-xs md:text-sm text-slate-700 dark:text-slate-200">
            <p class="font-semibold mb-1"
               data-en="How to play:"
               data-es="C√≥mo jugar:">
              How to play:
            </p>
            <ol class="list-decimal list-inside space-y-1">
              <li data-en="Press ‚ÄúStart Game‚Äù. You will see an order with 3 hawker dishes."
                  data-es="Presiona ‚ÄúIniciar Juego‚Äù. Ver√°s un pedido con 3 platos de hawker.">
                Press ‚ÄúStart Game‚Äù. You will see an order with 3 hawker dishes.
              </li>
              <li data-en="Memorize the dishes before they disappear."
                  data-es="Memoriza los platos antes de que desaparezcan.">
                Memorize the dishes before they disappear.
              </li>
              <li data-en="When the grid appears, click the correct dishes from the board."
                  data-es="Cuando aparezca la cuadr√≠cula, haz clic en los platos correctos del tablero.">
                When the grid appears, click the correct dishes from the board.
              </li>
              <li data-en="You must pick all dishes from the order before time runs out."
                  data-es="Debes elegir todos los platos del pedido antes de que se acabe el tiempo.">
                You must pick all dishes from the order before time runs out.
              </li>
              <li data-en="Each correct round gives you XP. Try to complete all 5 rounds!"
                  data-es="Cada ronda correcta te da XP. ¬°Intenta completar las 5 rondas!">
                Each correct round gives you XP. Try to complete all 5 rounds!
              </li>
            </ol>
          </div>

          <!-- Dish Grid -->
          <div class="bg-slate-50 dark:bg-slate-800/80 rounded-xl p-4 mb-4">
            <p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-[0.2em] mb-3"
               data-en="HAWKER DISH BOARD"
               data-es="TABLERO DE PLATOS HAWKER">
              HAWKER DISH BOARD
            </p>
            <div id="dishGrid" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
              <!-- botones generados por JS -->
            </div>
          </div>

          <!-- Feedback + Next -->
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
            <p id="feedbackText" class="text-xs md:text-sm text-slate-700 dark:text-slate-200"></p>
            <button id="nextRoundButton"
                    class="w-full md:w-auto bg-emerald-500 text-white font-semibold py-2.5 px-5 rounded-full text-xs md:text-sm hover:bg-emerald-600 transition-colors disabled:opacity-40 disabled:cursor-not-allowed"
                    disabled>
              <span class="material-symbols-outlined align-middle mr-1 text-sm">restart_alt</span>
              <span data-en="Next Round" data-es="Siguiente Ronda">Next Round</span>
            </button>
          </div>

          <!-- Final result -->
          <div id="finalResultBox" class="hidden mt-6 border-t border-slate-200 dark:border-slate-700 pt-4">
            <h3 class="font-bold text-lg mb-1"
                data-en="Mission Complete!"
                data-es="¬°Misi√≥n Completada!">
              Mission Complete!
            </h3>
            <p id="finalSummary" class="text-sm text-slate-700 dark:text-slate-200 mb-3"></p>
            <button id="playAgainButton"
                    class="bg-primary text-white font-semibold py-2.5 px-6 rounded-full text-xs md:text-sm hover:bg-primary/90 transition-colors">
              <span class="material-symbols-outlined align-middle mr-1 text-sm">replay</span>
              <span data-en="Play Again" data-es="Jugar de Nuevo">Play Again</span>
            </button>
          </div>
        </section>

      </div>
    </main>

    <!-- FOOTER -->
    <footer class="w-full bg-background-light dark:bg-background-dark">
      <div class="mx-auto max-w-7xl px-4 py-8 sm:px-8">
        <div class="flex flex-col items-center justify-between gap-4 border-t border-slate-200 pt-8 dark:border-slate-800 sm:flex-row">
          <p class="text-sm text-slate-600 dark:text-slate-400">¬© 2024 XPL√òR. All Rights Reserved.</p>
          <div class="text-sm text-slate-600 dark:text-slate-400">
            Follow us: <span class="font-semibold text-slate-800 dark:text-slate-200">@xplor.pty</span>
          </div>
        </div>
      </div>
    </footer>

  </div>
</div>

<script>
  // ===================== NAVBAR: MOBILE MENU =====================
  const menuButton = document.getElementById('mobileMenuBtn');
  const mobileMenu = document.getElementById('mobileMenu');
  const menuContent = document.getElementById('menuContent');
  const menuOverlay = document.getElementById('menuOverlay');
  const menuIcon = document.getElementById('menuIcon');

  function openMenu() {
    mobileMenu.classList.remove('hidden');
    void mobileMenu.offsetWidth;
    menuOverlay.classList.remove('opacity-0');
    menuContent.classList.remove('translate-x-full');
    menuContent.classList.add('translate-x-0');
    menuIcon.innerText = 'close';
  }

  function closeMenu() {
    menuOverlay.classList.add('opacity-0');
    menuContent.classList.remove('translate-x-0');
    menuContent.classList.add('translate-x-full');
    menuIcon.innerText = 'menu';
    setTimeout(() => {
      mobileMenu.classList.add('hidden');
    }, 300);
  }

  if (menuButton) {
    menuButton.addEventListener('click', () => {
      if (mobileMenu.classList.contains('hidden')) {
        openMenu();
      } else {
        closeMenu();
      }
    });
  }
  if (menuOverlay) {
    menuOverlay.addEventListener('click', closeMenu);
  }
  const menuLinks = mobileMenu.querySelectorAll('a');
  menuLinks.forEach(link => link.addEventListener('click', closeMenu));

  // ===================== LANGUAGE SWITCH =====================
  let currentLanguage = localStorage.getItem("xplorLang") || "en";

  const langBtn = document.getElementById("langBtn");
  const langMenu = document.getElementById("langMenu");

  if (langBtn) {
    langBtn.addEventListener("click", () => {
      if (langMenu.style.display === "block") {
        langMenu.style.display = "none";
      } else {
        langMenu.style.display = "block";
      }
    });
  }

  document.querySelectorAll("#langMenu button").forEach(btn => {
    btn.addEventListener("click", () => {
      const lang = btn.dataset.lang;
      applyLanguage(lang);
      langMenu.style.display = "none";
    });
  });

  function applyLanguage(lang) {
    currentLanguage = lang;
    localStorage.setItem("xplorLang", lang);
    document.querySelectorAll("[data-en]").forEach(el => {
      const en = el.getAttribute("data-en");
      const es = el.getAttribute("data-es");
      el.textContent = lang === "es" ? (es || en) : en;
    });
    updateDynamicTexts();
  }

  // ===================== GAME LOGIC =====================

  const DISHES = [
    {
      id: "chicken_rice",
      emoji: "üçó",
      name_en: "Hainanese Chicken Rice",
      name_es: "Arroz de Pollo Hainan√©s"
    },
    {
      id: "laksa",
      emoji: "üçú",
      name_en: "Laksa Noodle Soup",
      name_es: "Sopa de Fideos Laksa"
    },
    {
      id: "satay",
      emoji: "üç¢",
      name_en: "Satay Skewers",
      name_es: "Brochetas Satay"
    },
    {
      id: "nasi_lemak",
      emoji: "üçö",
      name_en: "Nasi Lemak",
      name_es: "Nasi Lemak"
    },
    {
      id: "roti_prata",
      emoji: "ü•û",
      name_en: "Roti Prata",
      name_es: "Roti Prata"
    },
    {
      id: "chilli_crab",
      emoji: "ü¶Ä",
      name_en: "Chilli Crab",
      name_es: "Cangrejo con Chili"
    }
  ];

  const NUM_ROUNDS = 5;
  const ORDER_SIZE = 3;
  const MEMORIZE_TIME = 4;  // seconds
  const ANSWER_TIME = 12;   // seconds
  const POINTS_PER_ROUND = 150;

  let round = 1;
  let score = 0;
  let currentOrder = [];
  let selectedIds = new Set();
  let phase = "idle"; // idle | memorize | answer | finished
  let timeLeft = 0;
  let timerInterval = null;

  const roundLabel = document.getElementById("roundLabel");
  const timeLabel = document.getElementById("timeLabel");
  const scoreLabel = document.getElementById("scoreLabel");
  const orderContainer = document.getElementById("orderContainer");
  const orderMessage = document.getElementById("orderMessage");
  const phaseLabel = document.getElementById("phaseLabel");
  const dishGrid = document.getElementById("dishGrid");
  const feedbackText = document.getElementById("feedbackText");
  const startButton = document.getElementById("startButton");
  const nextRoundButton = document.getElementById("nextRoundButton");
  const finalResultBox = document.getElementById("finalResultBox");
  const finalSummary = document.getElementById("finalSummary");
  const playAgainButton = document.getElementById("playAgainButton");
  const instructionsToggle = document.getElementById("instructionsToggle");
  const instructionsBox = document.getElementById("instructionsBox");

  // Textos din√°micos seg√∫n idioma
  const textMap = {
    phase_memorize: {
      en: "Memorize the order!",
      es: "¬°Memoriza el pedido!"
    },
    phase_answer: {
      en: "Now select the correct dishes from the board.",
      es: "Ahora selecciona los platos correctos del tablero."
    },
    phase_idle: {
      en: "",
      es: ""
    },
    phase_timeout: {
      en: "Time's up! The correct dishes are highlighted in green.",
      es: "¬°Se acab√≥ el tiempo! Los platos correctos est√°n en verde."
    },
    correct_round: {
      en: "Perfect order! You earned XP.",
      es: "¬°Pedido perfecto! Has ganado XP."
    },
    wrong_pick: {
      en: "That dish was not in the order. Check the highlighted dishes.",
      es: "Ese plato no estaba en el pedido. Observa los platos resaltados."
    },
    final_low: {
      en: "Nice try! You are starting your hawker journey. Keep training your memory!",
      es: "¬°Buen intento! Est√°s comenzando tu viaje hawker. ¬°Sigue entrenando tu memoria!"
    },
    final_mid: {
      en: "Great job! You handled the hawker rush like a pro.",
      es: "¬°Gran trabajo! Manejaste la hora pico del hawker como una profesional."
    },
    final_high: {
      en: "Legendary! You are a Hawker Memory Master in XPL√òR.",
      es: "¬°Legendaria! Eres una Maestra de la Memoria Hawker en XPL√òR."
    }
  };

  function updateDynamicTexts() {
    // Feedback / phase labels are set inside logic; nothing extra here for now.
  }

  function shuffleArray(arr) {
    const array = [...arr];
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function endGame() {
    running = false;
    gameOver = true;

    // üëâ GUARDAR XP DEL JUEGO
    localStorage.setItem("xp_sjuego", score);

    if (score > bestScore) {
      bestScore = score;
      localStorage.setItem('dashBestScore', String(bestScore));
      updateBestLabel();
    }

    const seconds = (elapsedMs / 1000).toFixed(1);
    statusText.textContent = currentLang === 'es'
      ? `¬°Fin del juego! Puntaje: ${score} ‚Ä¢ Tiempo: ${seconds} s. Presiona Reset o Start para intentar de nuevo.`
      : `Game Over! Score: ${score} ‚Ä¢ Time: ${seconds} s. Press Reset or Start to try again.`;
}

  function resetBoardStyles() {
    const cards = dishGrid.querySelectorAll(".dish-card");
    cards.forEach(card => {
      card.classList.remove("selected-correct", "selected-wrong", "opacity-40");
    });
  }

  function renderDishGrid() {
    dishGrid.innerHTML = "";
    DISHES.forEach(dish => {
      const btn = document.createElement("button");
      btn.className = "dish-card flex flex-col items-center justify-center gap-1 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-900 py-3 px-2 text-xs md:text-sm font-medium text-slate-800 dark:text-slate-100 hover:border-primary hover:bg-primary/5 transition-colors";
      btn.dataset.id = dish.id;
      btn.innerHTML = `
        <span class="text-2xl">${dish.emoji}</span>
        <span>${currentLanguage === "es" ? dish.name_es : dish.name_en}</span>
      `;
      btn.addEventListener("click", () => handleDishClick(dish.id, btn));
      dishGrid.appendChild(btn);
    });
  }

  function updateDishNamesForLanguage() {
    const cards = dishGrid.querySelectorAll(".dish-card");
    cards.forEach(card => {
      const id = card.dataset.id;
      const dish = DISHES.find(d => d.id === id);
      if (!dish) return;
      const spans = card.querySelectorAll("span");
      if (spans.length === 2) {
        spans[1].textContent = currentLanguage === "es" ? dish.name_es : dish.name_en;
      }
    });
  }

  function setPhase(newPhase) {
    phase = newPhase;
    switch (phase) {
      case "memorize":
        phaseLabel.textContent = textMap.phase_memorize[currentLanguage];
        break;
      case "answer":
        phaseLabel.textContent = textMap.phase_answer[currentLanguage];
        break;
      default:
        phaseLabel.textContent = "";
    }
  }

  function setTime(seconds) {
    timeLeft = seconds;
    timeLabel.textContent = String(timeLeft).padStart(2, "0");
  }

  function startTimer(duration, onFinish) {
    clearInterval(timerInterval);
    setTime(duration);
    timerInterval = setInterval(() => {
      timeLeft--;
      timeLabel.textContent = String(timeLeft).padStart(2, "0");
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        onFinish();
      }
    }, 1000);
  }

  function createOrderPills() {
    orderContainer.innerHTML = "";
    currentOrder.forEach(dish => {
      const pill = document.createElement("div");
      pill.className = "inline-flex items-center gap-2 bg-white dark:bg-slate-900 border border-primary/40 rounded-full px-3 py-1 text-xs md:text-sm text-slate-800 dark:text-slate-100 shadow-sm";
      pill.innerHTML = `<span>${dish.emoji}</span><span>${currentLanguage === "es" ? dish.name_es : dish.name_en}</span>`;
      orderContainer.appendChild(pill);
    });
  }

  function showOrderThenHide() {
    createOrderPills();
    setPhase("memorize");
    feedbackText.textContent = "";
    // Memorize timer
    startTimer(MEMORIZE_TIME, () => {
      // Hide order, go to answer phase
      orderContainer.innerHTML = "";
      const p = document.createElement("p");
      p.className = "text-sm text-slate-600 dark:text-slate-300";
      p.textContent = textMap.phase_answer[currentLanguage];
      orderContainer.appendChild(p);
      setPhase("answer");
      resetBoardStyles();
      selectedIds.clear();
      startTimer(ANSWER_TIME, () => {
        // Time out
        endRoundTimeout();
      });
    });
  }

  function startRound() {
    if (round > NUM_ROUNDS) return;

    finalResultBox.classList.add("hidden");
    nextRoundButton.disabled = true;
    resetBoardStyles();
    selectedIds.clear();
    feedbackText.textContent = "";

    // Create new random order
    const shuffled = shuffleArray(DISHES);
    currentOrder = shuffled.slice(0, ORDER_SIZE);

    roundLabel.textContent = round;
    showOrderThenHide();
  }

  function handleDishClick(dishId, btnElement) {
    if (phase !== "answer") return;
    if (selectedIds.has(dishId)) return;

    const isInOrder = currentOrder.some(d => d.id === dishId);
    selectedIds.add(dishId);

    if (!isInOrder) {
      // Wrong pick => end round immediately
      btnElement.classList.add("selected-wrong");
      endRoundWrong();
      return;
    }

    // Correct pick
    btnElement.classList.add("selected-correct");

    if (selectedIds.size === ORDER_SIZE) {
      endRoundSuccess();
    }
  }

  function highlightCorrectDishes() {
    const cards = dishGrid.querySelectorAll(".dish-card");
    cards.forEach(card => {
      const id = card.dataset.id;
      const inOrder = currentOrder.some(d => d.id === id);
      if (inOrder) {
        card.classList.add("selected-correct");
      } else {
        card.classList.add("opacity-40");
      }
    });
  }

  function endRoundSuccess() {
    clearInterval(timerInterval);
    score += POINTS_PER_ROUND;
    scoreLabel.textContent = score;
    feedbackText.textContent = textMap.correct_round[currentLanguage];
    highlightCorrectDishes();
    nextRoundButton.disabled = false;
    if (round === NUM_ROUNDS) {
      finishGame();
    }
  }

  function endRoundWrong() {
    clearInterval(timerInterval);
    feedbackText.textContent = textMap.wrong_pick[currentLanguage];
    highlightCorrectDishes();
    nextRoundButton.disabled = false;
    if (round === NUM_ROUNDS) {
      finishGame();
    }
  }

  function endRoundTimeout() {
    feedbackText.textContent = textMap.phase_timeout[currentLanguage];
    highlightCorrectDishes();
    nextRoundButton.disabled = false;
    if (round === NUM_ROUNDS) {
      finishGame();
    }
  }

  function finishGame() {
    phase = "finished";
    nextRoundButton.disabled = true;
    finalResultBox.classList.remove("hidden");

    let msg;
    if (score <= POINTS_PER_ROUND * 2) {
      msg = textMap.final_low[currentLanguage];
    } else if (score <= POINTS_PER_ROUND * 4) {
      msg = textMap.final_mid[currentLanguage];
    } else {
      msg = textMap.final_high[currentLanguage];
    }
    finalSummary.textContent = `${msg} (${score} XP)`;
  }

  function resetGame() {
    round = 1;
    score = 0;
    scoreLabel.textContent = "0";
    setTime(0);
    phase = "idle";
    orderContainer.innerHTML = "";
    orderMessage.textContent = currentLanguage === "es"
      ? "Haz clic en ‚ÄúIniciar Juego‚Äù para recibir tu primer pedido."
      : "Click on ‚ÄúStart Game‚Äù to receive your first order.";
    phaseLabel.textContent = "";
    feedbackText.textContent = "";
    finalResultBox.classList.add("hidden");
    resetBoardStyles();
  }

  // Event Listeners for Game
  if (startButton) {
    startButton.addEventListener("click", () => {
      resetGame();
      startRound();
    });
  }

  if (nextRoundButton) {
    nextRoundButton.addEventListener("click", () => {
      if (round < NUM_ROUNDS) {
        round++;
        startRound();
      }
    });
  }

  if (playAgainButton) {
    playAgainButton.addEventListener("click", () => {
      resetGame();
      startRound();
    });
  }

  if (instructionsToggle && instructionsBox) {
    instructionsToggle.addEventListener("click", () => {
      if (instructionsBox.classList.contains("hidden")) {
        instructionsBox.classList.remove("hidden");
      } else {
        instructionsBox.classList.add("hidden");
      }
    });
  }

  // Inicializar grid y lenguaje
  renderDishGrid();
  applyLanguage(currentLanguage);
  updateDishNamesForLanguage();

  // Actualizar nombres de platos si cambia el idioma
  const observer = new MutationObserver(() => {
    updateDishNamesForLanguage();
  });
  observer.observe(document.documentElement, { attributes: true, childList: false, subtree: false });

  function showResults() {
    triviaSection.classList.add('hidden');
    resultCard.classList.remove('hidden');

    // üëâ GUARDAR XP AQU√ç
    localStorage.setItem("xp_ptrivia1", score);

    finalScoreLabel.textContent = score.toString();
    correctAnswersLabel.textContent = correctAnswers.toString();
    totalQuestionsLabel.textContent = questions.length.toString();

    const total = questions.length;
    let msg;
    if (currentLanguage === 'es') {
      msg = `¬°Misi√≥n completada! Aciertos: ${correctAnswers}/${total}. Sigue explorando para ganar m√°s puntos y subir de nivel.`;
    } else {
      msg = `Mission completed! Correct answers: ${correctAnswers}/${total}. Keep exploring to earn more points and level up.`;
    }
    finalMessage.textContent = msg;
}

</script>
</body>
</html>
